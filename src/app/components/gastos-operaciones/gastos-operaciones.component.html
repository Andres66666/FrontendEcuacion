<div id="contentToExport">
  <h2 class="mb-4 text-center text-uppercase">
    PRESUPUESTO POR ACTIVIDAD Y GENERAL DEL PROYECTO
  </h2>
  <!-- Formulario de porcentajes -->
  <div class="rounded shadow-sm">
    <div class="row">
      <!-- Modal Proyecto y Par치metros -->
      <div
        class="modal fade"
        id="modalProyectoParametros"
        tabindex="-1"
        aria-labelledby="modalProyectoParametrosLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="modalProyectoParametrosLabel">
                {{
                  proyectoSeleccionado
                    ? "Par치metros del Proyecto"
                    : "Crear Nuevo Proyecto"
                }}
              </h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>

            <div class="modal-body">
              <!-- Nombre del Proyecto -->
              <div class="mb-3">
                <label class="form-label">Nombre del Proyecto</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="nombreProyecto"
                  placeholder="Ingrese nombre del proyecto"
                />
              </div>

              <!-- Tabla de Par치metros -->
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th class="text-center">PAR츼METROS</th>
                    <th class="text-center">EN PORCENTAJE (%)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>CARGAS SOCIALES</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="carga_social"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>IVA TASA EFECTIVA</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="iva_efectiva"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>HERRAMIENTAS</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="herramientas"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>GASTOS GENERALES</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="gastos_generales"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>IVA TASA NOMINAL</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="iva_tasa_nominal"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>IT TASA NOMINAL</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="it"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>IUE</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="iue"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>GANANCIA</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="ganancia"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>A - COSTO DE VENTA</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="a_costo_venta"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>B - MARGEN DE UTILIDAD</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="b_margen_utilidad"
                        (ngModelChange)="actualizarParametrosEnTiempoReal()"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>PORCENTAJE GLOBAL</td>
                    <td>
                      <input
                        type="number"
                        class="form-control text-center"
                        [(ngModel)]="porcentaje_global_100"
                        disabled
                      />
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
              <button
                type="button"
                class="btn btn-primary"
                (click)="
                  proyectoSeleccionado
                    ? guardarParametros()
                    : registrarNuevoProyecto()
                "
              >
                {{
                  proyectoSeleccionado ? "Guardar Cambios" : "Crear Proyecto"
                }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 游늷 Columna Derecha: Selecci칩n Proyecto + Botones -->
      <div
        class="col-12 d-flex flex-row flex-wrap align-items-center justify-content-start gap-3 mb-3 no-export"
      >
        <!-- Input del proyecto -->
        <div class="position-relative flex-grow-1" style="min-width: 200px">
          <input
            class="form-control text-center"
            placeholder="Nombre del Proyecto"
            [(ngModel)]="nombreProyecto"
            (focus)="focusInput()"
            (input)="filtrarProyectos()"
          />
          <ul
            *ngIf="mostrarLista"
            class="list-group position-absolute text-start"
            style="
              z-index: 1000;
              max-height: 200px;
              overflow-y: auto;
              width: 100%;
            "
          >
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
              *ngFor="let proyecto of proyectosFiltrados"
            >
              <span
                (click)="seleccionarProyecto(proyecto)"
                style="cursor: pointer"
              >
                {{ proyecto.NombreProyecto }}
              </span>

              <button
                class="btn btn-sm btn-primary"
                type="button"
                (click)="duplicarProyecto(proyecto, $event)"
                title="Duplicar proyecto"
              >
                <img
                  src="https://cdn-icons-png.flaticon.com/128/3384/3384831.png"
                  class="img-fluid"
                  style="width: 40px; height: 40px"
                />
                Duplicar
              </button>
            </li>
          </ul>
        </div>

        <!-- Botones -->
        <button
          class="btn d-flex flex-column align-items-center no-export"
          title="Ver Par치metros"
          [disabled]="!proyectoSeleccionado"
          (click)="abrirModalParametros(true)"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/9390/9390678.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Ver Par치metros</small>
        </button>

        <button
          class="btn d-flex flex-column align-items-center no-export"
          title="Crear Nuevo Proyecto"
          (click)="abrirModalParametros(false)"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/11750/11750438.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Nuevo Proyecto</small>
        </button>

        <button
          class="btn d-flex flex-column align-items-center no-export"
          *ngIf="identificadorGeneral === 0"
          (click)="crearIdentificadorSiEsNecesario()"
          title="Registrar Proyecto"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/17087/17087969.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Registrar Proyecto</small>
        </button>

        <button
          class="btn d-flex flex-column align-items-center no-export"
          *ngIf="identificadorGeneral !== 0"
          (click)="eliminarProyecto()"
          title="Eliminar Proyecto"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/6861/6861362.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Eliminar Proyecto</small>
        </button>
        <button
          class="btn d-flex flex-column align-items-center no-export"
          [disabled]="identificadorGeneral === 0"
          (click)="agregarItem()"
          title="Agregar 칈tem Gastos Operaci칩n"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/1493/1493661.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Agregar 칈tem</small>
        </button>
        <!-- Bot칩n Agregar M칩dulo: CORREGIDO con [disabled] para validar proyecto -->
        <button
          class="btn d-flex flex-column align-items-center no-export"
          [disabled]="identificadorGeneral === 0"
          (click)="agregarModulo()"
          title="Agregar M칩dulo (requiere proyecto seleccionado)"
          aria-label="Agregar Nuevo M칩dulo"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/3081/3081305.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
            alt="칈cono Agregar M칩dulo"
          />
          <small>Agregar M칩dulo</small>
        </button>
        <button
          class="btn d-flex flex-column align-items-center no-export"
          *ngIf="identificadorGeneral !== 0"
          (click)="actualizarProyecto()"
          title="Actualizar Proyecto"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/1601/1601884.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Actualizar Proyecto</small>
        </button>
        <button
          class="btn d-flex flex-column align-items-center no-export"
          (click)="exportPDF()"
          title="Exportar a PDF"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/6968/6968842.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Descargar PDF</small>
        </button>

        <button
          class="btn d-flex flex-column align-items-center no-export"
          (click)="exportWORD()"
          title="Exportar a Word"
        >
          <img
            src="https://cdn-icons-png.flaticon.com/128/888/888883.png"
            class="img-fluid"
            style="width: 40px; height: 40px"
          />
          <small>Descargar Word</small>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de Gastos de Operaci칩n (CORREGIDA: Colspan din치micos en todo) -->
  <div class="table-responsive border rounded shadow-sm">
    <table
      class="table table-bordered table-hover align-middle text-center mb-0"
    >
      <thead class="table-primary">
        <tr>
          <th class="text-center align-middle" style="width: 5%">Item</th>
          <th class="text-center align-middle" style="width: 25%">
            Descripci칩n
          </th>
          <th
            *ngIf="mostrarColumnaModulo"
            class="text-center align-middle"
            style="width: 7%"
          >
            M칩dulo
          </th>
          <th class="text-center align-middle" style="width: 5%">Unidad</th>
          <th class="text-center align-middle" style="width: 5%">Cantidad</th>
          <th class="text-center align-middle" style="width: 5%">
            Gastos De Operacion
          </th>
          <th class="text-center align-middle" style="width: 5%">
            Valor Agregado
          </th>
          <th class="text-center align-middle" style="width: 5%">
            Precio Unitario Actividad
          </th>
          <th class="text-center align-middle" style="width: 10%">
            Precio Unitario Literal
          </th>
          <th class="text-center align-middle" style="width: 5%">
            Precio Factura Parcial
          </th>
          <th class="text-center align-middle no-export" style="width: 10%">
            Acciones
          </th>
        </tr>
      </thead>

      <tbody cdkDropList (cdkDropListDropped)="drop($event)">
        <tr *ngFor="let item of items; let i = index" cdkDrag>
          <!-- 1. Fila de M칩dulo Temporal (para agregar/registro) -->
          <ng-container *ngIf="item.tipo === 'modulo'">
            <td
              [attr.colspan]="mostrarColumnaModulo ? 11 : 10"
              class="bg-light text-start"
            >
              <div class="d-flex align-items-center gap-2">
                <span class="fw-bold">M칩dulo:</span>
                <input
                  [(ngModel)]="item.codigo"
                  class="form-control w-auto"
                  placeholder="C칩digo"
                  style="max-width: 120px"
                />
                <input
                  [(ngModel)]="item.nombre"
                  class="form-control"
                  placeholder="Nombre del m칩dulo"
                />
                <button
                  class="btn btn-danger btn-sm no-export"
                  (click)="eliminarItem(i)"
                >
                  <i class="bi bi-trash"></i>
                </button>
                <button
                  class="btn btn-success btn-sm no-export"
                  (click)="registrarModulo(i)"
                  title="Registrar m칩dulo"
                >
                  <i class="bi bi-check2-circle me-1"></i> Registrar
                </button>
              </div>
            </td>
          </ng-container>

          <!-- 2. Fila de M칩dulo Registrado (persistente, agrupador) -->
          <ng-container *ngIf="item.tipo === 'modulo_registrado'">
            <td
              [attr.colspan]="mostrarColumnaModulo ? 11 : 10"
              class="bg text-black fw-bold text-start"
              style="font-size: 1.1em"
            >
              <!-- Fila fija: No editable, con acciones -->
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-2">
                  Modulo:
                  <!-- Modo Vista (default) -->
                  <ng-container *ngIf="!item.editar; else modoEditar">
                    <span>{{ item.codigo }} - {{ item.nombre }}</span>
                  </ng-container>
                  <!-- Modo Edici칩n: Inputs visibles si editar = true -->
                  <ng-template #modoEditar>
                    <input
                      [(ngModel)]="item.codigo"
                      class="form-control w-auto me-2"
                      placeholder="C칩digo"
                      style="max-width: 120px"
                      (blur)="actualizarModuloRegistrado(i)"
                    />
                    <input
                      [(ngModel)]="item.nombre"
                      class="form-control me-2"
                      placeholder="Nombre del m칩dulo"
                      (blur)="actualizarModuloRegistrado(i)"
                    />
                  </ng-template>
                </div>
                <div class="d-flex gap-1">
                  <!-- Bot칩n Editar: Solo en modo vista -->
                  <button
                    *ngIf="!item.editar"
                    class="btn btn-warning btn-sm no-export"
                    (click)="editarModulo(i)"
                    title="Editar m칩dulo"
                  >
                    <i class="bi bi-pencil"></i>
                  </button>
                  <!-- Bot칩n Guardar: Solo en modo edici칩n -->
                  <button
                    *ngIf="item.editar"
                    class="btn btn-success btn-sm no-export"
                    (click)="actualizarModuloRegistrado(i)"
                    title="Guardar cambios"
                  >
                    <i class="bi bi-check2"></i>
                  </button>
                  <!-- Bot칩n Cancelar: Solo en modo edici칩n (usa m칠todo) -->
                  <button
                    *ngIf="item.editar"
                    class="btn btn-secondary btn-sm no-export"
                    (click)="cancelarEdicion(i)"
                    title="Cancelar"
                  >
                    <i class="bi bi-x"></i>
                  </button>
                  <!-- Bot칩n Eliminar: Siempre visible -->
                  <button
                    class="btn btn-danger btn-sm no-export"
                    (click)="eliminarModulo(i)"
                    title="Eliminar m칩dulo"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- 3. Fila de Gasto/Item (debajo de su m칩dulo) -->
          <ng-container *ngIf="item.tipo === 'gasto'">
            <td class="drag-handle" cdkDragHandle>
              {{ obtenerNumero(i) }}
              <!-- 칈cono mover: Ocultar si no hay m칩dulos -->
              <img
                *ngIf="modulos.length > 0"
                src="https://cdn-icons-png.flaticon.com/128/10187/10187191.png"
                class="img-fluid no-export"
                style="width: 40px; height: 40px"
                (click)="abrirModalMover(i)"
                title="Mover a otro m칩dulo"
                alt="칈cono de mover"
              />
            </td>

            <td class="input-cell">
              <input
                [(ngModel)]="item.descripcion"
                class="full-width-input"
                placeholder="Descripci칩n"
              />
            </td>

            <!-- Nueva Columna: M칩dulo (solo si hay gastos sin m칩dulo) -->
            <td *ngIf="mostrarColumnaModulo" class="input-cell">
              <ng-container
                *ngIf="item.esNuevo || item.editarModulo; else verModulo"
              >
                <!-- Select editable para nuevos o en edici칩n -->
                <select
                  class="form-select"
                  [(ngModel)]="item.moduloId"
                  (change)="
                    actualizarModulo(item); actualizarItemEnTiempoReal(item)
                  "
                >
                  <option value="">Sin m칩dulo</option>
                  <option *ngFor="let mod of modulos" [value]="mod.id">
                    {{ mod.codigo }} - {{ mod.nombre }}
                  </option>
                </select>
                <small class="text-muted d-block mt-1">Selecciona m칩dulo</small>
              </ng-container>
              <ng-template #verModulo>
                <!-- Vista para existentes: texto clickable para editar -->
                <p
                  (click)="item.editarModulo = true"
                  class="mb-0 fw-medium"
                  style="cursor: pointer; color: #007bff"
                  title="Click para editar m칩dulo"
                >
                  {{ obtenerNombreModulo(item.modulo || null) }}
                </p>
              </ng-template>
            </td>

            <!-- Unidad -->
            <td>
              <ng-container
                *ngIf="item.esNuevo || item.editarUnidad; else verUnidad"
              >
                <select
                  class="form-select"
                  [(ngModel)]="item.unidad"
                  (ngModelChange)="actualizarItemEnTiempoReal(item)"
                  (blur)="item.editarUnidad = false"
                >
                  <option value="">Seleccione unidad</option>
                  <option *ngFor="let unidad of unidades" [value]="unidad">
                    {{ unidad }}
                  </option>
                </select>
              </ng-container>

              <ng-template #verUnidad>
                <p
                  (click)="item.editarUnidad = true"
                  class="mb-0"
                  style="cursor: pointer"
                >
                  {{ unidadTexto(item.unidad ?? "") }}
                </p>
              </ng-template>
            </td>

            <!-- Cantidad -->
            <td class="input-cell text-center">
              <input
                type="number"
                [(ngModel)]="item.cantidad"
                (ngModelChange)="actualizarItemEnTiempoReal(item)"
                class="full-width-input text-center mb-0"
                title="Cantidad * Precio Unitario Actividad"
                placeholder="Cantidad"
                (ngModelChange)="item.cantidad = item.cantidad ?? 0"
              />
            </td>

            <!-- Gastos de Operaci칩n -->
            <td class="input-cell text-center">
              <p class="mb-0" title="Gastos De Operacion + Valor Agregado">
                {{ item.precio_unitario | number : "1.2-2" }}
              </p>
            </td>

            <!-- Valor Agregado -->
            <td class="input-cell text-center">
              <p class="mb-0" title="Gastos De Operacion + Valor Agregado">
                {{ formatearNumero(getValorAgregado(item)) }}
              </p>
            </td>

            <!-- Precio Unitario Actividad -->
            <td class="input-cell text-center">
              <p class="mb-0" title="Cantidad * Precio Unitario Actividad">
                {{ formatearNumero(SumaPrecioUnitarioActividad(item)) }}
              </p>
            </td>

            <!-- Precio Unitario Literal -->
            <td class="input-cell col-md-2">
              <textarea
                readonly
                [ngModel]="item.precio_literal"
                class="form-control"
                placeholder="Literal"
                rows="2"
                style="resize: none; white-space: pre-line"
              ></textarea>
            </td>

            <!-- Precio Factura Parcial -->
            <td
              class="text-center"
              title="Cantidad * Precio Unitario Actividad"
            >
              {{
                formatearNumero(
                  MultiplicacionPrecioUnitarioActividadPORcantidad(item)
                )
              }}
            </td>

            <!-- Acciones -->
            <td class="no-export">
              <div class="d-flex justify-content-center gap-1">
                <ng-container *ngIf="item.esNuevo; else accionesExistente">
                  <button
                    class="btn btn-success btn-sm"
                    (click)="registrarItem(i)"
                  >
                    <i class="bi bi-check2-circle me-1"></i> Registrar
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    (click)="eliminarItem(i)"
                  >
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                  <button
                    class="btn btn-warning btn-sm"
                    (click)="enviarAEcuacion(item)"
                  >
                    <i class="bi bi-send"></i> Ver Ecuaciones
                  </button>
                </ng-container>

                <ng-template #accionesExistente>
                  <button
                    class="btn btn-primary btn-sm"
                    (click)="actualizarItem(i)"
                  >
                    <i class="bi bi-pencil"></i> Actualizar
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    (click)="eliminarItem(i)"
                  >
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                  <button
                    class="btn btn-warning btn-sm"
                    (click)="enviarAEcuacion(item)"
                  >
                    <i class="bi bi-send"></i> Precio Unitario
                  </button>
                  <button
                    class="btn btn-success btn-sm"
                    (click)="enviarTotalGastosGenerales(item)"
                  >
                    <i class="bi bi-receipt"></i> Reporte Financiero
                  </button>
                </ng-template>
              </div>
            </td>
          </ng-container>
        </tr>

        <tr *ngIf="items.length === 0" class="no-export">
          <td
            [attr.colspan]="mostrarColumnaModulo ? 11 : 10"
            class="text-center text-muted py-4"
          >
            No hay 칤tems registrados.
          </td>
        </tr>
      </tbody>

      <tfoot class="table-light">
        <tr>
          <td [attr.colspan]="mostrarColumnaModulo ? 5 : 4"></td>
          <!-- Ajustado din치micamente: 5 columnas con m칩dulo, 4 sin m칩dulo -->
          <td class="fw-bold text-center">
            {{ formatearNumero(totalGastosOperacionGeneral) }}
            <button
              class="btn btn-success btn-sm ms-2 no-export"
              (click)="enviarTotalesAFactura()"
              title="Reporte General"
            >
              <i class="bi bi-receipt"></i>
            </button>
          </td>
          <td class="fw-bold text-center">
            {{ formatearNumero(totalValorAgregado) }}
          </td>
          <td colspan="2" class="text-end fw-bold">
            TOTAL GASTOS DE OPERACI칍N
          </td>
          <td class="fw-bold text-center">{{ formatearNumero(total) }}</td>
          <td class="no-export"></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <p class="text-center text-muted mt-3 fw-bold">Son: {{ totalLiteral }}</p>

  <!-- Modal para Asociar/Mover a M칩dulo (칰nico, actualizado) -->
  <div
    class="modal fade"
    id="modalMover"
    tabindex="-1"
    aria-labelledby="modalMoverLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="modalMoverLabel">
            Asociar/Mover a M칩dulo
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p>
            Selecciona el m칩dulo al que deseas asociar este gasto (o "Sin
            m칩dulo"):
          </p>
          <select class="form-select" [(ngModel)]="moduloSeleccionado">
            <option value="">Sin m칩dulo</option>
            <option *ngFor="let mod of modulos" [value]="mod.id">
              {{ mod.codigo }} - {{ mod.nombre }}
            </option>
          </select>
          <!-- Acceso seguro: *ngIf para evitar null indexing -->
          <small
            class="text-muted d-block mt-2"
            *ngIf="itemIndexAMover !== null"
          >
            M칩dulo actual:
            {{ obtenerNombreModulo(items[itemIndexAMover!].modulo || null) }}
          </small>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="confirmarMoverModulo()"
            [disabled]="
              itemIndexAMover === null ||
              (!moduloSeleccionado &&
                items[itemIndexAMover!].modulo?.id !== null)
            "
          >
            Confirmar
          </button>
        </div>
      </div>
    </div>
  </div>

  <app-confirmacion
    *ngIf="mostrarConfirmacion"
    [mensaje]="mensajeConfirmacion"
    (aceptar)="manejarAceptar()"
    (cancelar)="manejarCancelar()"
  ></app-confirmacion>
  <app-ok
    *ngIf="mensajeExito"
    [mensaje]="mensajeExito"
    (close)="manejarOk()"
  ></app-ok>
  <app-error
    *ngIf="mensajeError"
    [mensaje]="mensajeError"
    (close)="manejarError()"
  ></app-error>
</div>
